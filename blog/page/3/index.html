
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>Ember.js, random thoughts, journal  | machty's thoughtz</title>

<meta name="author" content="Alex Matchneer"> 

<meta name="description" content="I'm on Ember core and contribute to lots of stuff prefixed with "Em"."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="machty's thoughtz" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">machty's thoughtz</a></h1>
<h4>Ember.js, random thoughts, journal</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archive</a></li>
	<li>
    <span>
    <a href="http://www.cram.com/flashcards/alexmatchneercom-4692833" target="_blank">Flashcards</a>
    </span>
    <span>
    (<a href="/blog/2014/04/12/blog-flashcards/">explanation</a>)
    </span>
  </li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/archives">Archive</a></li>
	<li>
    <span>
    <a href="http://www.cram.com/flashcards/alexmatchneercom-4692833" target="_blank">Flashcards</a>
    </span>
    <span>
    (<a href="/blog/2014/04/12/blog-flashcards/">explanation</a>)
    </span>
  </li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:machty.github.com">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/18/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>Cookies</h2>

<p>What ends up in <code>document.cookie</code>?</p>

<p>Test: kill a previous localhost:5000 server, start a server for a
separate project. Reload the page. Request headers sent include
a transient cookie from the previous server. I bet it was due to
Turbolinks. I was right!</p>

<p>From http://tools.ietf.org/html/rfc6265#section-4.1.1</p>

<blockquote><p> Origin servers MAY send a Set-Cookie response header with any
 response.  User agents MAY ignore Set-Cookie headers contained in
 responses with 100-level status codes but MUST process Set-Cookie
 headers contained in other responses (including responses with 400-
 and 500-level status codes).  An origin server can include multiple
 Set-Cookie header fields in a single response.  The presence of a
 Cookie or a Set-Cookie header field does not preclude HTTP caches
 from storing and reusing a response.</p></blockquote>

<p>So you can send multiple headers with the same key. Makes sense, since
comma separation will conflict with the UTC date (e.g. <code>Aug 12, 2014</code>).</p>

<p>So how do you set multiple cookies in Rack?</p>

<p>Interesting: https://github.com/rack/rack/blob/master/lib/rack/utils.rb#L266</p>

<p>Anyway, split cookies with newlines and Rack will cause this to send two
<code>Set-Cookie</code> headers, which is totally fine.</p>

<p>You can also use <code>set_cookie</code> on <code>Rack::Response</code> if you&#8217;re into that
sort of thing..</p>

<p>I psyched myself out thinking cookies were overwriting each other by doing:</p>

<pre><code>"Set-Cookie" =&gt; "foo\nbar\nbaz"
</code></pre>

<p><code>document.cookie</code> was only revealing <code>baz</code>. But, I&#8217;m a dumb: cookies
need to be key-value pairs, which fixed it.</p>

<p>You can use <code>HttpOnly</code> to prevent JS (and other APIs?) access to the
cookie sent by the server. Makes sense; less likely that&#8217;ll break
something.</p>

<p>Getting <code>document.cookie</code> returns all the cookies available to JS.
Setting it will only set the cookie you provide.</p>

<blockquote><p>Notice that servers can delete cookies by sending the user agent a
new cookie with an Expires attribute with a value in the past.</p></blockquote>

<h2>JavaScript set focus</h2>

<p><code>focus()</code> is a method on input elements. So is <code>blur()</code>.</p>

<p><code>document.activeElement</code> in modern browsers points to the focused
element, which might also include scroll windows.</p>

<p>https://developer.mozilla.org/en-US/docs/Web/API/document.activeElement</p>

<p>In older browsers, to <code>blur</code> the active element, you&#8217;d have to know what
that element was; there was no way to query. Might be wrong about this.</p>

<h2>React Nested Router</h2>

<p>http://www.youtube.com/watch?v=P6xTa3RRzfA</p>

<ul>
<li>State is just data</li>
<li>Your route is data, e.g. you could render a top-level App component
and tell it what its route is, and render everything a la React,
pretend like you&#8217;re redrawing the whole page.</li>
<li>Rather than switch-statement-based routing, the <code>activeRoute</code> just
gets passed in via <code>props</code> like any other property

<ul>
<li><code>router.match</code> handlers will create all the routes, and pass in a
single <code>activeRoute</code>; every route segment along the way just knows
about with its activeRoute child is, if one exists.</li>
<li>e.g. <code>contact/profile</code>, app.activeRoute = contact,
contact.activeRoute = profile</li>
</ul>
</li>
<li>API

<ul>
<li>Route component

<ul>
<li>handler = a React Class</li>
</ul>
</li>
</ul>
</li>
<li>Differences w Ember

<ul>
<li>No auto-gen &#8216;index&#8217; routes</li>
<li>paths don&#8217;t inherit parent paths

<ul>
<li>this means if you&#8217;re &#8220;overwriting&#8221; a parent dynamic segment, the
dynamic segment must appear <em>somewhere</em> in the child route so you
can actually load that data.

<ul>
<li>AH, the router will detect when children omit ids that their
parents have declared. That&#8217;s nice.</li>
<li>also yells at you if you use the same path in two places.</li>
</ul>
</li>
<li>nice that it lets you have <code>/profile</code> vs <code>/user</code></li>
</ul>
</li>
<li>Ember is less typing, but

<ul>
<li>React makes it easier to share handlers</li>
<li>Overwriting URL is nice when you need it, error checking is nice</li>
</ul>
</li>
</ul>
</li>
<li>So each non leaf handler gets <code>activeRoute</code>, all handlers get all
<code>params</code>.</li>
<li>Refactorability/decoupling:

<ul>
<li>Because route names and paths are fully specified and all params are provided to
each handler, changing the nesting of a route means you don&#8217;t have
to rewrite all your link-tos from &#8220;wat.foo&#8221; to &#8220;foo&#8221;. Then again
if you&#8217;re using resources you don&#8217;t have to do that either.</li>
</ul>
</li>
<li>Question: what about other <code>props</code> you&#8217;d want to pass into a
component?

<ul>
<li>Answer: Route components aren&#8217;t concerned with props other than how
to be a route handler.</li>
</ul>
</li>
</ul>


<p>http://jsbin.com/vukacule/6/edit</p>

<p>It is really cool that you can switch between rendering a route with App
as a handler vs just rendering App. The difference is that, when
route-driven, it gets passed props.</p>

<p>The <code>Route</code> components you use are obviously stateless; all state lives
on the Handlers.</p>

<p>Ah, in React <code>` syntax just means</code>{blah: &#8220;wat&#8221;}` inside
the normal single-curly.</p>

<p>How do Links work? They call transitionTo and there&#8217;s a single URLStore
singleton.</p>

<h2>TLS Replay?</h2>

<p>I had it in my head that man-in-the-middle wasn&#8217;t a problem for TLS but
maybe they could replay the messages? Turns out I am wrong; TLS includes
a sequence mechanism.</p>

<p>That being said, your app might send repeat messages, which demands its
own double checking / application-level sequencing or some other
prevention mechanism.</p>

<h2>chroot</h2>

<p>http://en.wikipedia.org/wiki/Chroot</p>

<p>Learned about this when speculating w Ember Core about how the front
page Rust evaluator works at http://www.rust-lang.org/</p>

<p>It runs a program with the assumption that <code>/</code> is somewhere else, and it
can&#8217;t access it.</p>

<p>Change</p>

<h2>process.nextTick</h2>

<p><code>process</code> doesn&#8217;t exist on the browser, so therefore neither does
<code>nextTick</code>, but you can hack it if you&#8217;re on a browser that has a native
<code>Promise</code> object, since the <a href="http://promisesaplus.com/">spec</a> mentions
that resolution callbacks must happen when the execution context
consists only of platform code.</p>

<blockquote><p>onFulfilled or onRejected must not be called until the execution
context stack contains only platform code. [3.1].</p></blockquote>

<p>So here&#8217;s how you could write nextTick, note that there&#8217;s no need to</p>

<pre><code>var p = Promise.resolve();
function nextTick(cb) {
  p.then(cb);
}
</code></pre>

<h2>Visibility API</h2>

<p><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/User_experience/Using_the_Page_Visibility_API">mdn</a></p>

<p>e.g.</p>

<ul>
<li>pause video when you tab-away</li>
<li>stop requestAnimationFrame</li>
</ul>


<h2>Closing over <code>let i</code></h2>

<pre><code>var fns = [];
for (var i = 0; i &lt; 10; ++i) {
  fns.push(function() {
    console.log(i);
  });
}
</code></pre>

<p>The above code has the gotcha that by the time the <code>fns</code> functions run,
they&#8217;ll all print out <code>10</code>, rather than the value of <code>i</code> when the
closing-over function was created. This is part of the reason why jshint
will yell at you for creating functions in a loop, e.g.</p>

<pre><code>var fns = [];
for (var i = 0; i &lt; 10; ++i) {
  fns.push(makeCallback(i));
}

function makeCallback(num) {
  return function() {
    console.log(num);
  }
}
</code></pre>

<p>Then <code>i</code> will be uniquely preserved for each callback.</p>

<p>The es6 <code>let</code> keyword gives you block scope, which includes everything
declared within the for loop. If you just use <code>let</code> in the original
code, you can do</p>

<pre><code>var fns = [];
for (let i = 0; i &lt; 10; ++i) {
  fns.push(function() {
    console.log(i);
  });
}
</code></pre>

<p><code>i</code> doesn&#8217;t get hoisted; rather, each iteration gets its own <code>i</code> value
that gets closed over.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-18T03:50:00-04:00" pubdate data-updated="true">Jul 18<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/16/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>WeakMap</h2>

<p>Use objects as keys. If you lose access to a key, it and its value will
eventually be removed by GC because references to keys are weak. This
also means WeakMaps are non enumerable since GC is non-deterministic and
a key that might exist pre GC might not exist after.</p>

<h2>ES6 Symbols</h2>

<p>They&#8217;re nothing like Ruby symbols.</p>

<p>They&#8217;re used to create unique, non-enumerable, keys that can&#8217;t be
determined publicly unless the symbol is exported. So you could prevent
tampering with a player&#8217;s score by storing the score on the player using
an unshared symbol as the key:</p>

<p>http://tc39wiki.calculist.org/es6/symbols/</p>

<h2>ES6 === Harmony === ES.next</h2>

<p>They&#8217;re all the same thing.</p>

<h2>JS 1.7 vs ES6, etc</h2>

<p><a href="http://ejohn.org/blog/versions-of-javascript/">jeresig clears this up a bit</a></p>

<p>All modern browsers support ECMAScript; JavaScript is a variant of it
that Mozilla&#8217;s largely been adding features to. ES3 === JS 1.5.</p>

<p>So I see <code>let</code> was added to JavaScript 1.7, so why is it now being
described as a new upcoming feature of ES6? Ah, because all browsers
track ECMAScript standards, even if they call their enhanced language in
the browser something else. Mozilla has been blazing ahead and trying
new shit, but other browsers won&#8217;t pick it up until it&#8217;s actually
standardized into ECMAScript.</p>

<p>Why would Microsoft follow ECMAScript? Well, for starters, it delivered
JScript to Ecma back in the day for standardization.</p>

<blockquote><p>The name &#8220;ECMAScript&#8221; was a compromise between the organizations involved in standardizing the language, especially Netscape and Microsoft, whose disputes dominated the early standards sessions.</p></blockquote>

<p>Interesting, and:</p>

<blockquote><p>While both JavaScript and JScript aim to be compatible with ECMAScript, they also provide additional features not described in the ECMA specifications</p></blockquote>

<p>Also, some reason I thought TC39 was part of Mozilla. I see that I am
obviously incorrect: http://www.ecma-international.org/memento/TC39.htm</p>

<p>It&#8217;s Ecma-TC39. The things I don&#8217;t know.</p>

<p>W3C Tag, Ecma-TC39. W3C Tag, Ecma-TC39.</p>

<h2><code>let</code></h2>

<p><code>let</code> behaves like C++ declarations; the obj is only available in the
curlies, or in for loops, or whatever, and there&#8217;s no hoisting. Outside
of the block, the variable is undefined.</p>

<h2>Cloudfront TTL</h2>

<p>TTL lets you specify a min time before CF checks the origin to see if it
has a new version of the file/response. You still need your origin
server&#8217;s Cache-Control headers setup correctly.</p>

<p><a href="http://stackoverflow.com/questions/10621099/what-is-a-ttl-0-in-cloudfront-useful-for">TTL can be 0</a>.
Why? TTL 0 means that it delegates Cache-Control entirely to the origin.
This means CF will always make a GET request w <code>If-Modified-Since</code>
header to let the server return <code>304 Not Modified</code>.</p>

<h2>Drag and Drop</h2>

<p>Draggable elements need to be marked as <code>draggable="true"</code>.</p>

<p>Then listen to the <code>ondragstart</code> event, e.g.
<code>ondragstart="drag(event)"</code>.</p>

<p>And then say what data is associated with the dragged el&#8230;</p>

<pre><code>ev.dataTransfer.setData("Text", ev.target.id);
</code></pre>

<p>This seems strange.</p>

<p>https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer</p>

<p>It really is a class associated only w drag and drop.</p>

<p>Should probably be reading this rather than fucking w3schools. Why do I
still do that?
https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Drag_and_drop</p>

<p>Ah I get it, you use dataTransfer as part of the mechanism for
dynamically determining drop targets. You have to prevent bubbling
(return false or preventDefault) on droppable targets, and in that fn
they have the option of looking up the data transfer to see if they want
to accept the data from that drag drop.</p>

<p>You can also configure drag drag visual details to indicate copying,
moving, etc. LOL such drag and drop.</p>

<p>Oof apparently it&#8217;s a fucking disaster: http://www.quirksmode.org/blog/archives/2009/09/the_html5_drag.html</p>

<p>Criticisms:</p>

<ul>
<li>7 fucking events, such API surface</li>
<li>&#8220;For the drop event to fire at all, you have to cancel the defaults of both the dragover and the dragenter event.&#8221;</li>
</ul>


<h2>Cordova events: sticky != buffered</h2>

<p>Sticky events (e.g. deviceready) just mean that once fired, they stay in
a fired state. This means you can&#8217;t have multiple events fire if it&#8217;s a
sticky event. I was originally thinking sticky meant all the events were
cached until the first handler was registered.</p>

<p>Ended up making this: https://gist.github.com/machty/e1cc485060f2951aeb6c</p>

<h2>Why <code>-print0</code> in <code>find</code>?</h2>

<p>Often you pipe the results of <code>find</code> into <code>xargs</code> to pass the results of
a <code>find</code> so that some utility can operate on each file found. GOOD
ENGRISH, MATCHNEER.</p>

<p>But since <code>xargs</code> splits based on whitespace by default, this will break
for files with newlines or or spaces in them, so <code>-print0</code> separates
files w null bytes, and <code>-0</code> tells xargs to split via null bytes as
well. Win win win. No difference if you have no files with spaces in
them.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-16T00:40:00-04:00" pubdate data-updated="true">Jul 16<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/15/forgotten-things/">
		
			Forgotten Things</a>
	</h2>
	<div class="entry-content">
		<p>Here&#8217;s a progressively-updated list of things I forget throughout the
day. This is different from the list of things I&#8217;ve learned; that
approach is useful for packing the things into my brain, hopefully; the
purpose of this list is to pack things back in when I forget. And for
now it&#8217;ll just be one giant progressively-updated blog.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-15T12:18:00-04:00" pubdate data-updated="true">Jul 15<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/14/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>Website Push != Push Notifications</h2>

<p>So when you&#8217;re rummaging through the Apple Dev Portal, don&#8217;t confuse the
two and generate the wrong certs. K?</p>

<h2>WWDC 2011 video on UIViewController Containment</h2>

<pre><code>https://developer.apple.com/videos/wwdc/2011/
</code></pre>

<p>First off, WWDC stands for the Apple World-Wide Developer Conference.</p>

<h2>Why view controllers</h2>

<ul>
<li>Make it easy to make high quality apps</li>
<li>Reusable</li>
</ul>


<p>A View Controller just a Controller. Mediates model data with many
views. View controllers maintain entire hierarchies of views. They&#8217;re
heavyweight, meant to manage a &#8220;screenful of content&#8221;. Often packaged
with a model, e.g.</p>

<ul>
<li>TweetViewController</li>
<li>ImagePickerController</li>
</ul>


<p>View Controllers are social, meant to connect to each other. They push
and pop each other, etc. They talk to each other a lot.</p>

<p>The &#8220;manage a screenful of content&#8221;:</p>

<p>View Controllers anticipate being presented in different ways. More
accurately: they should maintain a unit of content. Only
<code>rootViewController</code> manages a &#8220;screenful of content&#8221;, specifically the
<code>rootViewController</code> property of the window object. Knows how to forward
rotation events, decides overall layout.</p>

<p>How to use View Controllers</p>

<ul>
<li>subclass UIViewController</li>
<li>associate VC w view hierarchy</li>
<li>override callbacks</li>
</ul>


<p>Apperance callbacks: viewWillAppear, viewDidAppear, etc
Rotation callbacks: viewWillRotate, etc</p>

<p>ViewControllers manage an entire view hierarchy. Not just one to one
with a view.</p>

<p>View Controller Containers, a tale of Two Hierarchies: view hierarchies
and view controller hierarchies.</p>

<p>Container controllers</p>

<ul>
<li>responsible for parent child relationships

<ul>
<li>API like <code>initWithRootViewController</code> implies parent-child in nav
controller</li>
<li>split view controllers lets you set view controller children.</li>
</ul>
</li>
</ul>


<p>Controller container api</p>

<ul>
<li>addChildViewController

<ul>
<li>not meant to be called by anyone but its own implementation; don&#8217;t
call it on other controllers, basically</li>
</ul>
</li>
<li>remoteFromParentViewController

<ul>
<li>^^ ditto</li>
</ul>
</li>
<li>childViewControllers array</li>
<li>callbacks

<ul>
<li>willMoveToParentViewController</li>
<li>didMoveToParentViewController</li>
</ul>
</li>
</ul>


<p>Shouldn&#8217;t be able to walk up view hierarchy and totally skip over a
parent view controller: UIViewControllerHierarchyInconsistencyException,
prevents you from manually adding views into the wrong view controller
hierarchy.</p>

<p>When are appearance callbacks called?</p>

<p>viewWillAppear etc has nothing to do w addChildViewController, which has
nothing to do w view appearance.</p>

<p>viewWillAppear just means it&#8217;s in the window view hiearchy, but doesn&#8217;t
mean it&#8217;s actually visible (same w viewDidAppear).</p>

<p>TODO: what is view layoutSubviews?</p>

<p>viewDidAppear after the view added to viewHierarchy. Called after
layoutSubviews.</p>

<p>When implementing transitions, you have to implement
didTransitionToBlahBlah, one of the options is <code>animations</code> lambda.</p>

<p>VS Layout callbacks:</p>

<ul>
<li>viewWillLayoutSubviews&#8230;</li>
</ul>


<p>Presentation and Dismissal of VCs</p>

<p>set presentation style and then do presentViewController</p>

<p>Can also present VCs by direct subview manipulation.</p>

<pre><code>[root.someView addSubview: vc.view]
</code></pre>

<p>But this is bad form; better to make the VC a child of the root VC. VC
knows where subviews should go rather than the ass backwards way.</p>

<p>When to create a custom view controller container?</p>

<ul>
<li>Hopefully you don&#8217;t need to, so think twice first</li>
<li>Aesthetics</li>
<li>Custom app flows</li>
<li>Your app manipulates view hiearchy directly</li>
</ul>


<p>Use case: make split view show up in both landscape and portrait: no
need to make custom VC because now there&#8217;s API to just better configure
split view.</p>

<p>View controllers know themselves if they&#8217;re moving to or from parent
view controllers within viewWillAppear and viewDidAppear by checking:</p>

<pre><code>// used in viewDid/WillAppear
- (BOOL)isMovingToParentViewController;

// used in viewDid/WillDisappear
- (BOOL)isMovingFromParentViewController;

- isBeingPresented;
- isBeingDismissed;
</code></pre>

<p>Lol:</p>

<pre><code>- (BOOL) automaticallyForwardAppearanceAndRotationMethodsToChildViewControllers;
</code></pre>

<h2>RFC</h2>

<p>RFC&#8217;s (Request for Comments):</p>

<blockquote><p>Memos in the Requests for Comments (RFC) document series contain technical and organizational notes about the Internet</p></blockquote>

<p>http://www.ietf.org/about/</p>

<p>So many standards organizations. How am I supposed to keep this separate
from IEEE?</p>

<p>Anyway, RFCs are docs produced by IETF. I don&#8217;t think anyone else
(notable) produces docs called RFCs.</p>

<h2>Push Notifications</h2>

<p>Two levels of trust involved in publishing a push notifications:</p>

<h3>Connection Trust</h3>

<ul>
<li>Provider-side: provider proves it is an authorized provider that
Apple&#8217;s agreed to publish notifications for</li>
<li>Device-side: APNs must validate the connection is a with a legit
device</li>
</ul>


<h3>Token Trust</h3>

<p>Establishes certainty that messages are routed correctly; a provider
shouldn&#8217;t be able to send messages to random iPhones.</p>

<ul>
<li>APNs gives device a token</li>
<li>Devices gives it to provider</li>
<li>Provider uses it when publishing to APNs</li>
<li>APNs uses it to route back to device</li>
</ul>


<p>A <code>device token</code> is not a device <code>UDID</code>; aside from being a totally
different string, it is conceptually different in that it identifies not
only the unique device, but the application the Push Notification is
delivered to.</p>

<p>Maybe that&#8217;s what&#8217;s confusing: don&#8217;t call it a <code>device token</code>, call
it&#8230; an app-token? I get confused by the easiest things.</p>

<h3>Providers must maintain persistent connection</h3>

<p>If you want to send a notification through APNS (and GCM),
you must maintain a persistent connection to the server. In other words,
you can&#8217;t just connect-sendmessage-disconnect a la HTTP, which makes
push notifications inconvenient for Rails-y architectures without
using Sidekiq/Resque to reuse a persistent connection.</p>

<p>I both:</p>

<ol>
<li>failed to realize that this was a requirement for a while and</li>
<li>failed to understand why</li>
</ol>


<p>The best justification for this architecture that I can determine from
the docs and people I&#8217;ve talked to is that constantly
connecting/disconnecting to what is a high-performance, low-latency,
distributed system would be a colossal waste of resources and a latency
hit. An app capable of notifications is essentially a stream that APNS
consumes, and might be sending thousands of messages, so either way
they&#8217;d at least need to support a persistent connection for performance
reasons, and if they&#8217;re going to support that, why bother supporting
an obviously deficient connect/disconnect-based server interaction.</p>

<p>How many other services can be considered consumers of your stream?</p>

<h3>Service-to-Device Connection Trust</h3>

<p>Device identity is established via TLS peer-to-peer auth (internally;
iOS devs don&#8217;t need to implement this).</p>

<ul>
<li>Device TLS auths w APNs</li>
<li>APNs returns certificate, which it validates</li>
<li>Device sends device certificate to APNs</li>
<li>APNs valiates device certificate</li>
</ul>


<p>So I guess this prevents:</p>

<ul>
<li>an iPhone mimicker pretending to be something it&#8217;s not</li>
<li>an APNs ripoff pretending to be something it&#8217;s not</li>
</ul>


<h3>Provider-to-APNS connection trust</h3>

<p>Same process as above, just w provider (your server) and APNS.</p>

<p>A connection to APNs can only serve a single application, identified by
the topic (bundle ID) specified in the certificate, presumably the
one you generate in the online dev console. Also, APNs has a certificate
revocation list; if a provider is on that list, it&#8217;s connection will be
refused/closed. I think this would happen if you didn&#8217;t implement a
persistent connection to APNs but rather treated it like HTTP and kept
closing/opening the connection.</p>

<h3>Token Generation and Dispersal / token trust</h3>

<p>Jesus christ why don&#8217;t I just RTFM? It solves all the problems. Ah yes,
arm-chair ADD.</p>

<ul>
<li>Application asks system to register</li>
<li>System (iOS) forwards this to APNs</li>
<li>APNs generates device token using info in the certficate (presumably
the one established as described above) and encrypts it, and sends
back the encrypted token</li>
<li>App gets the encrypted key as an <code>NSData</code>, and must send it to the
provider in hexidecimal format</li>
</ul>


<p>This guarantees that only APNs generated the token used for routing
(since it&#8217;s encrypted by some private key within APNs). This token can
only be used for the device that originally connected to receive
notifications.</p>

<h3>Trust components</h3>

<p>e.g. keys/certificates you need to create/provide to APNs for all of
this shit to work:</p>

<ul>
<li><p>Provider</p>

<ul>
<li>unique provider certificate and private key for validating
connection to APNs</li>
<li>certificate identifies a topic that the provide can publish to (the
app&#8217;s bundle id).</li>
<li>Provider provides device token.</li>
<li>Provider can additionally validate that it&#8217;s talking to APNs using
the public server certificate provide&#8230; at connection time?</li>
</ul>
</li>
<li><p>Device</p>

<ul>
<li>obvious stuff already covered</li>
</ul>
</li>
</ul>


<p>Note: &#8220;topic&#8221; today is literally the bundle ID of the app. A certificate
identifies which apps it&#8217;s allowed to broadcast notifications to via
this topic. Maybe in the future, topics can refer to multiple apps?
Right now it&#8217;s coupled to bundle ID, in the future, this could be a
configurable thing&#8230; multiple apps could subscribe to the same topic?
This is all bullshit atm but what I think based on their terminology.
It&#8217;s really just a really constrained pub-sub, where apps can&#8217;t
subscribe to message channels other than the one that uniquely
identifies their app+device tuple.</p>

<h3>Coalescing</h3>

<p>APNs is last-write wins in that that in the case of multiple
notifications, only the last one will be stored-forwarded to the app.
This isn&#8217;t to say they coalesce within your device (validated by the
fact that you&#8217;ll see multiple messages from IRCCloud rather than a
single one saying &#8220;new messages available&#8221;), but specifically refers to
the storage of messages undeliverable because the client app&#8217;s turned
off. GCM gives you more fine-grained control over this.</p>

<h3>Summary</h3>

<p>So, given that I&#8217;ve been fighting this bullshit, realizations:</p>

<p>I need to stop revoking/re-creating the APNs app certificate generated
in the Apple Dev console. It&#8217;s not like it&#8217;s tied to some private/public
key or anything.</p>

<h2>Difference b/w .pem and .cer, etc</h2>

<p>I had to run this to convert .cer to .pem</p>

<pre><code>openssl x509 -in aps_development.cer -inform DER -out aps_development.pem
</code></pre>

<h3>X.509</h3>

<pre><code>http://en.wikipedia.org/wiki/X.509
</code></pre>

<p>X.509 is an ITU-T (Telecommunication Standardization Sector)
standard that describes certificate generation, revocation, and other
utilities. <code>openssl</code> just happens to support x509 certificate
generation.</p>

<p>Remember: x509 means one thing: certificates. If you see x509 in the
wild, it&#8217;s probably talking about certificates. x509 certificates.
Certificates.</p>

<p>x509 is unlike PGP in that it maintains a hierarchical chain of
certificate signers, each validated by the previous, with a root CA
(Certificate Authority) starting the chain. PGP relies (or at least
originally relied on) a Web of Trust.</p>

<h3>PEM</h3>

<p><code>---BEGIN CERTIFICATE---</code> and <code>---END CERTIFICATE---</code>.</p>

<p>Can contain multiple certificate and even the prviate key. &#8220;The private
key&#8221;? Which private key? Answer: the one that&#8217;s automatically generated
by Keychain Access and similar utilities when you create a Certificate
Signing Request (CSR).</p>

<p><a href="http://stackoverflow.com/a/7947362/914123">See here</a></p>

<p>TODO: can you even use an existing public/private key? Probably, but
possibly less secure:</p>

<p><a href="http://en.wikipedia.org/wiki/Certificate_signing_request">Read the wiki, you dingus</a></p>

<h2>PKCS</h2>

<p>(public key cryptography standards) created by RSA Security in the 90s.
It&#8217;s a family of standards relating to cryptography.</p>

<p>PCKS 1 is a standard, PCKS 9 is a standard, PCKS 12 is a standard.</p>

<p>Exporting multiple cryptography shits in a single file falls under the
PKCS 12 standard. PKCS 12 also handles bundling all the members of a
CHAIN OF TRUST.</p>

<blockquote><p>It is commonly used to bundle a private key with its X.509 certificate or to bundle all the members of a chain of trust.</p></blockquote>

<p>Makes sense, must be a common thing. Apple obviously does that. AWS SNS
expects you to upload a <code>.p12</code> that it splits into a cert and priv key.</p>

<p>File name extension is <code>.p12</code> (which I&#8217;ve seen) or <code>.pfx</code> which I&#8217;ve
not.</p>

<p><a href="http://en.wikipedia.org/wiki/PKCS_12">Wiki</a></p>

<p>So if I understand correctly, the purpose of certificate is so that you
can encrypt data, and anyone who wants to validate that you are who you
say you are can look up the certificate chain.</p>

<p>You create a pub/priv key pair, create a CSR with it, and then the
approving authority gives you a certificate that you can hand to other
people. The certificate can be used to validate that whatever you
encrypted with your (still unshared and totally) private key, can be
guaranteed to have originated from you. Without certification, you&#8217;re
just some entity with a pub/priv key pair&#8230; and&#8230; I don&#8217;t know, need
to read up more on the implications of this. Amazing how hard this stuff
is.</p>

<p>Anyway, <code>pkcs12</code> is the <code>openssl</code> file utility for creating/parsing
pkcs12 file.</p>

<h2><code>man</code> page sections</h2>

<p>Valid:</p>

<pre><code>man crontab
man 1 crontab # equiv to above
man -s 1 crontab # equiv to above
man 5 crontab 
man -s 5 crontab # equiv to above
</code></pre>

<p>Invalid:</p>

<pre><code>man 2 crontab # No entry for crontab in section 2 of the manual
man 3 crontab # ditto
man 4 crontab # ditto
</code></pre>

<p>Why would it have pages 1 and 5 but not 2-4?</p>

<p><a href="http://en.wikipedia.org/wiki/Man_page">Ahhhh!</a></p>

<p>Turns out there are sections (that vary by platform):</p>

<pre><code>1   General commands
2   System calls
3   Library functions, covering in particular the C standard library
4   Special files (usually devices, those found in /dev) and drivers
5   File formats and conventions
6   Games and screensavers
7   Miscellanea
8   System administration commands and daemons
</code></pre>

<p><code>crontab</code> has no system calls, lib fns, special files, but it does have
general commands and file formats.</p>

<p><code>man</code> isn&#8217;t just unix commands, but also lib, system calls, C functions,
etc.</p>

<p>These sections also handle cases when unrelated concepts have the same
name&#8230; there might be an <code>exit</code> C fn (there is) and an <code>exit</code> terminal
command.</p>

<p>This explains the wording here:</p>

<pre><code>No entry for printf in section 4 of the manual
</code></pre>

<p>You don&#8217;t look up the <code>printf</code> page, and then its section 4
subsection&#8230; rather, you look up entries in a section of <code>man</code>.</p>

<p>That&#8217;s the same reason it&#8217;s <code>man 3 printf</code> rather than <code>man printf 3</code></p>

<p>God, such an obvious thing I never understood/remembered.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-14T09:33:00-04:00" pubdate data-updated="true">Jul 14<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/13/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>HTML is an API, getAttribute</h2>

<p>HTML is just a string of characters that get converted into DOM. You can
also create DOM via the JavaScript DOM API. Seems like an obvious thing
I guess but it just clicked for me.</p>

<p>What&#8217;s an attribute? It&#8217;s any key-value pair (or occasional boolean)
within an open tag.</p>

<pre><code>&lt;div id="lol" snaggletooth="blorg"&gt;&lt;/div&gt;
</code></pre>

<p><code>id</code> and <code>snaggletooth</code> are attributes. During HTML parsing, the browser
will convert this isn&#8217;t an HTML element (which is a node). HTML elements
have a fixed set of <em>properties</em>. All the <em>attributes</em> you provide in
your HTML that map to known properties will set the values of those
properties, hence <code>.id</code> gets set to &#8220;lol&#8221;, but <code>.snaggletooth</code> would
yield <code>undefined</code>, because that&#8217;s obviously not a real property name.</p>

<p>http://jsbin.com/bejog/1/edit</p>

<p>This also explains why you can set an <code>&lt;input&gt;</code>&#8217;s value to &#8220;wat&#8221;, then
type in a new value in the input field, and <code>getAttribute("value")</code> will
still yield <code>"wat"</code> even though <code>inputElement.value</code> will equal whatever
you typed in.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-13T15:18:00-04:00" pubdate data-updated="true">Jul 13<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/08/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<p>This blog left intentionally blank. There are flashcards about browser
networking attached to it.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-08T14:31:00-04:00" pubdate data-updated="true">Jul 8<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/05/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>Bandwidth</h2>

<p>Grigorik&#8217;s book confused me when he switched from the bits/second
definition of bandwidth to the more signal processing definition.</p>

<pre><code>http://en.wikipedia.org/wiki/Bandwidth_(computing)
vs
http://en.wikipedia.org/wiki/Bandwidth_(signal_processing)
</code></pre>

<p>Computing bandwidth refers to bits/s. Signal bandwidth is the difference
in the max and min Hz that you transmit on.</p>

<p>This is interesting:</p>

<blockquote><p>A key characteristic of bandwidth is that any band of a given width can
carry the same amount of information, regardless of where that band is
located in the frequency spectrum. For example, a 3 kHz band
can carry a telephone conversation whether that band is at baseband
(as in a POTS telephone line) or modulated to some higher frequency.</p></blockquote>

<p>My understanding of this is that regardless of the modulation alphabet
you use, modulation will always cause a signal to vary between a
minimumm and maximum frequency, which determines the bandwidth of a
signal. For example, transmitting a &#8220;01&#8221; might mean squeezing the waves
together tightly until the next &#8220;letter&#8221; to transmit, and the tightest
those waves are squeezed determines the maximum frequency, while &#8220;10&#8221;
might might loosening the waves, and other letters could be some
combination of the two, but the key thing here is that bandwidth
determines the min and max frequencies that those waves can compress
or expand to; any more and you might be interfering with someone else&#8217;s
band.</p>


		
		<a href="/blog/2014/07/05/daily-journal/" class="more-link">Read on &rarr;</a>
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-05T16:44:00-04:00" pubdate data-updated="true">Jul 5<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/07/01/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>window vs document events</h2>

<p><code>window</code> and <code>document</code> have different events. Duh.</p>

<p><code>window</code>:</p>

<ul>
<li>resize</li>
</ul>


<p><code>document</code>:</p>

<ul>
<li>DOMContentLoaded</li>
</ul>


<p>Breakdown of events and their originators:</p>

<p>https://developer.mozilla.org/en-US/docs/Web/Events</p>

<p>Fun fact: DOMContentLoaded is considered a DOM mutation event.</p>

<h2>Treat stubbed cordova as its own platform</h2>

<p>I&#8217;m doing a Phonegap/Cordova app and it&#8217;s been tricky settling on a
pattern for stubbing out the cordova library when I&#8217;m just running in
Chrome or anywhere not in the actual native cordova wrapper, and I think
I found the final solution: clone https://github.com/apache/cordova-js,
define a new platform with a fake exec, have the fake exec look up some
stubbed handlers that you can define in your app, (e.g.
<code>window._stubbedCordovaHandlers[blahblah]</code>) and basically leave it up to
your app to stub out all the native plugin services/actions. The effect
of all of this is that your index.html always loads a cordova.js (which
has some other conveniences like stick event handlers, pub sub channels,
etc) but you don&#8217;t have to have a bunch of conditionals asking whether
this is a stubbed version of the app or not.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-07-01T10:03:00-04:00" pubdate data-updated="true">Jul 1<span>st</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/29/daily-journal/">
		
			Daily Journal</a>
	</h2>
	<div class="entry-content">
		<h2>DAS thangs</h2>

<p>Ctrl-Z suspends a task, but you can resume a task via <code>%1</code> or <code>%2</code>, etc,
referencing the number next to the job as displayed in <code>jobs</code>:</p>

<pre><code>[1]- suspended bleh
[2]+ suspended lol
[3]  suspended lol
</code></pre>

<p>You can also do <code>%-</code> and <code>%+</code>.</p>

<h3>Inline loops</h3>

<pre><code>while true; do echo "wat"; sleep 1; done
</code></pre>

<p>ctrl-z to suspend, <code>bg</code> to convert a suspended job to a background job.</p>

<p>Open the output of a command in <code>vim</code>: <code>echo woot | view -</code></p>

<ul>
<li><code>view</code> is a <code>vim -R</code> alias that opens in read-only mode</li>
<li><code>-</code> option reads the file from stdin</li>
</ul>


<p>The man page for <code>vim</code> / <code>view</code> mentions that commands are read from
stderror. So how would we run a command that reads input from stdin and
commands from stderr? TODO: this.</p>

<pre><code>machty.github.com :: &lt;(echo "wat")
-bash: /dev/fd/63: Permission denied
machty.github.com :: echo &lt;(echo "wat")
/dev/fd/63
</code></pre>

<p><code>&lt;()</code> will run a command and put its output in a file descriptor which
is file-like enough to work as an input to most commands. Gary&#8217;s example
is the &#8220;diff of diffs&#8221;, which is mostly useful to see if two branches
(e.g. one rebased and the other not) have the same content.</p>

<pre><code>diff -u &lt;(git diff master~5..master~1) &lt;(git diff master~4..master)
</code></pre>

<p>Can diff google com and fr, e.g.</p>

<pre><code>diff &lt;(curl www.google.com | tidy) &lt;(curl www.google.fr | tidy) | view -
</code></pre>

<p>This is stupidly cool. Another use case is diffing localhost w deployed
site.</p>

<h2>subterfuge</h2>

<p>I thought this word was a synonym for &#8220;plasma&#8221;, as in the liquid-y
filler part of blood that&#8217;s revealed when you spin blood in a
centrifuge. I think the centrifuge&#8217;s involvement in that tripped me up.</p>

<p>http://www.merriam-webster.com/dictionary/subterfuge</p>

<p>It actually just means</p>

<ul>
<li>deceit used in order to achieve one&#8217;s goal</li>
</ul>


<h2>Cordova My Mac 64-bit</h2>

<p>This was the only thing showing up after I changed the project name in
config.xml away from what I&#8217;d had it as when I first generated the iOS
platform. Remember this crap; I&#8217;m sure I&#8217;ll have to fight it again.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-29T19:29:00-04:00" pubdate data-updated="true">Jun 29<span>th</span>, 2014</time></div>
	


	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/06/29/social-media-triggers/">
		
			Social Media Triggers</a>
	</h2>
	<div class="entry-content">
		<p>I&#8217;ve enjoyed about a week away from Twitter, and hope to prolong this
hiatus. Twitter isn&#8217;t consistent with a lot of the lifestyle
changes I&#8217;ve been nagging myself to make. Twitter is snack drawer
positioned arms-reach away from the bed of someone trying to maintain a
diet. It&#8217;s a total trigger for me to retrogress into class clown attention
whore behavior I&#8217;ve been exhibiting since I was 5. So I&#8217;m on a break.</p>

<p>Twitter encourages me to project a public facade of empty-headed
buffoonery fueled by zany sarcasm and Photoshop. The last few months,
I&#8217;ve had various opportunities to meet in person people who only know me
by this facade, and it&#8217;s draining and depressing to keep it up in
person.</p>

<p>So I&#8217;m on a break. I&#8217;ve rediscovered distraction-free boredom. And it&#8217;s
been glorious. I play music again. I sing. When I get frustrated in my
endeavors to improve at my hobbies or my crafts, I have one less
mindless outlet distracting me away from pushing through the difficult
moments. Maybe I&#8217;ll return to Twitter when I have an album to promote.
Or something worth talking about.</p>

<p>This is where I&#8217;m supposed to apologize for a serious post.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-06-29T19:00:00-04:00" pubdate data-updated="true">Jun 29<span>th</span>, 2014</time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/social-media/'>social media</a>

</div>


	
</div></article>

<nav id="pagenavi">
    
        <a href="/blog/page/2/" class="prev">Prev</a>
    
    
        <a href="/blog/page/4/" class="next">Next</a>
    
    <div class="center"><a href="/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2014

    Alex Matchneer

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'usefuldude';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-49928757-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>

